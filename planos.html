<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MEGAVISION ‚Äî Planos</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="megavision-data.js"></script>
  <script src="megavision-auth.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{background:#0a0a0f;color:#e2e8f0;font-family:'DM Sans',sans-serif;min-height:100vh;}

    .mv-nav{position:sticky;top:0;z-index:100;background:rgba(10,10,15,.97);backdrop-filter:blur(16px);border-bottom:1px solid #1e1e2e;padding:0 28px;display:flex;align-items:center;justify-content:space-between;height:60px;}
    .mv-nav-logo{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;background:linear-gradient(135deg,#7c3aed,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none;}
    .mv-nav-right{display:flex;align-items:center;gap:12px;}
    .mv-nav-right a{color:#94a3b8;font-size:13px;text-decoration:none;padding:6px 14px;border-radius:8px;transition:all .2s;}
    .mv-nav-right a:hover{background:#1e1e2e;color:#e2e8f0;}

    .main{max-width:1000px;margin:0 auto;padding:48px 24px;}

    .hero-planos{text-align:center;margin-bottom:48px;}
    .hero-planos h1{font-family:'Syne',sans-serif;font-size:36px;font-weight:800;background:linear-gradient(135deg,#e2e8f0,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:12px;}
    .hero-planos p{color:#94a3b8;font-size:15px;}

    .planos-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:48px;}

    .plano-card{background:#111118;border:1px solid #1e1e2e;border-radius:16px;padding:28px;position:relative;transition:all .3s;}
    .plano-card.destaque{border-color:#7c3aed;box-shadow:0 0 40px rgba(124,58,237,.2);}
    .plano-card.destaque::before{content:'MAIS POPULAR';position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:#7c3aed;color:#fff;font-size:10px;font-weight:800;padding:4px 14px;border-radius:20px;letter-spacing:1px;}

    .plano-nome{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;margin-bottom:6px;}
    .plano-preco{font-family:'Syne',sans-serif;font-size:36px;font-weight:800;margin:16px 0 4px;}
    .plano-preco span{font-size:14px;font-weight:400;color:#94a3b8;}
    .plano-desc{color:#94a3b8;font-size:13px;margin-bottom:24px;line-height:1.5;}

    .plano-features{margin-bottom:28px;}
    .plano-feature{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid #1e1e2e;font-size:13px;color:#e2e8f0;}
    .plano-feature:last-child{border-bottom:none;}
    .plano-feature .ok{color:#10b981;font-weight:700;}
    .plano-feature .no{color:#475569;}
    .plano-feature .limit{color:#f59e0b;font-size:11px;}

    .btn-plano{width:100%;padding:14px;border-radius:10px;font-weight:700;font-size:14px;border:none;cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif;}
    .btn-gratis{background:#1e1e2e;color:#94a3b8;}
    .btn-basico{background:#06b6d4;color:#fff;}
    .btn-premium{background:#7c3aed;color:#fff;}
    .btn-plano:hover{opacity:.9;transform:translateY(-1px);}

    /* MODAL PIX */
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;align-items:center;justify-content:center;}
    .modal.ativo{display:flex;}
    .modal-content{background:#111118;border:1px solid #1e1e2e;border-radius:16px;padding:32px;width:90%;max-width:480px;}
    .modal-title{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;margin-bottom:20px;}
    .pix-box{background:#0a0a0f;border:2px dashed #7c3aed;border-radius:12px;padding:20px;text-align:center;margin-bottom:20px;}
    .pix-chave{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;color:#a78bfa;margin-bottom:8px;}
    .pix-valor{font-size:28px;font-weight:800;color:#10b981;margin-bottom:4px;}
    .pix-desc{color:#94a3b8;font-size:12px;}
    .copy-btn{background:#7c3aed;color:#fff;padding:10px 20px;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-size:13px;margin-top:10px;}

    .field{margin-bottom:14px;}
    .field label{display:block;font-size:12px;font-weight:600;color:#94a3b8;text-transform:uppercase;letter-spacing:.6px;margin-bottom:6px;}
    .field input,.field textarea{width:100%;background:#0a0a0f;border:1px solid #1e1e2e;border-radius:8px;color:#e2e8f0;padding:10px 14px;font-size:14px;outline:none;font-family:'DM Sans',sans-serif;}
    .field input:focus,.field textarea:focus{border-color:#7c3aed;}

    .btn-enviar{width:100%;background:#10b981;color:#fff;padding:14px;border-radius:10px;font-weight:700;font-size:14px;border:none;cursor:pointer;}
    .btn-cancelar{width:100%;background:transparent;border:1px solid #1e1e2e;color:#64748b;padding:10px;border-radius:8px;font-weight:600;cursor:pointer;margin-top:8px;}

    .alert{padding:12px 14px;border-radius:8px;font-size:13px;margin-bottom:14px;display:none;}
    .alert.sucesso{background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.3);color:#6ee7b7;display:block;}
    .alert.erro{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.3);color:#fca5a5;display:block;}

    .plano-atual-banner{background:rgba(124,58,237,.1);border:1px solid rgba(124,58,237,.3);border-radius:12px;padding:16px 20px;margin-bottom:32px;display:flex;align-items:center;justify-content:space-between;}
    .plano-atual-info{font-size:14px;color:#e2e8f0;}
    .plano-atual-info strong{color:#a78bfa;}

    @media(max-width:700px){.planos-grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>

<nav class="mv-nav">
  <a href="index.html" class="mv-nav-logo">‚ö° MEGAVISION</a>
  <div class="mv-nav-right">
    <a href="index.html">‚Üê Voltar</a>
    <a href="#" id="btnLogout" onclick="MVAuth.logout()">Sair</a>
  </div>
</nav>

<div class="main">
  <div class="hero-planos">
    <h1>Escolha seu Plano</h1>
    <p>Comece gr√°tis e fa√ßa upgrade quando precisar de mais poder</p>
  </div>

  <div id="planoAtualBanner" class="plano-atual-banner" style="display:none;">
    <div class="plano-atual-info">Seu plano atual: <strong id="planoAtualNome">‚Äî</strong></div>
    <span id="planoAtualBadge"></span>
  </div>

  <div class="planos-grid">

    <!-- GRATUITO -->
    <div class="plano-card">
      <div class="plano-nome" style="color:#94a3b8;">üÜì Gratuito</div>
      <div class="plano-preco" style="color:#94a3b8;">R$ 0<span>/m√™s</span></div>
      <div class="plano-desc">Para come√ßar a usar o ecossistema</div>
      <div class="plano-features">
        <div class="plano-feature"><span class="ok">‚úì</span> Financial Pro <span class="limit">(at√© 20 transa√ß√µes)</span></div>
        <div class="plano-feature"><span class="ok">‚úì</span> Assistente Vendas <span class="limit">(5/dia)</span></div>
        <div class="plano-feature"><span class="ok">‚úì</span> Control Vendas <span class="limit">(at√© 10 registros)</span></div>
        <div class="plano-feature"><span class="no">‚úó</span> App Vendas</div>
        <div class="plano-feature"><span class="no">‚úó</span> Quiz Itaipu</div>
        <div class="plano-feature"><span class="no">‚úó</span> Leadership Academy</div>
        <div class="plano-feature"><span class="no">‚úó</span> Vendas Passaporte</div>
      </div>
      <button class="btn-plano btn-gratis" onclick="window.location.href='index.html'">Plano Atual</button>
    </div>

    <!-- B√ÅSICO -->
    <div class="plano-card destaque">
      <div class="plano-nome" style="color:#22d3ee;">‚≠ê B√°sico</div>
      <div class="plano-preco" style="color:#22d3ee;" id="precoBasico">R$ ??<span>/m√™s</span></div>
      <div class="plano-desc">Para equipes de vendas que querem mais</div>
      <div class="plano-features">
        <div class="plano-feature"><span class="ok">‚úì</span> Financial Pro <span class="limit">(500 transa√ß√µes)</span></div>
        <div class="plano-feature"><span class="ok">‚úì</span> Assistente Vendas <span class="limit">(50/dia)</span></div>
        <div class="plano-feature"><span class="ok">‚úì</span> Control Vendas <span class="limit">(200 registros)</span></div>
        <div class="plano-feature"><span class="ok">‚úì</span> App Vendas</div>
        <div class="plano-feature"><span class="ok">‚úì</span> Quiz Itaipu</div>
        <div class="plano-feature"><span class="no">‚úó</span> Leadership Academy</div>
        <div class="plano-feature"><span class="no">‚úó</span> Vendas Passaporte</div>
      </div>
      <button class="btn-plano btn-basico" onclick="abrirPix('basico')">‚≠ê Assinar B√°sico</button>
    </div>

    <!-- PREMIUM -->
    <div class="plano-card">
      <div class="plano-nome" style="color:#a78bfa;">üíé Premium</div>
      <div class="plano-preco" style="color:#a78bfa;" id="precoPremium">R$ ??<span>/m√™s</span></div>
      <div class="plano-desc">Acesso total a todas as ferramentas</div>
      <div class="plano-features">
        <div class="plano-feature"><span class="ok">‚úì</span> Financial Pro <span class="limit">(ilimitado)</span></div>
        <div class="plano-feature"><span class="ok">‚úì</span> Assistente Vendas <span class="limit">(ilimitado)</span></div>
        <div class="plano-feature"><span class="ok">‚úì</span> Control Vendas <span class="limit">(ilimitado)</span></div>
        <div class="plano-feature"><span class="ok">‚úì</span> App Vendas</div>
        <div class="plano-feature"><span class="ok">‚úì</span> Quiz Itaipu</div>
        <div class="plano-feature"><span class="ok">‚úì</span> Leadership Academy</div>
        <div class="plano-feature"><span class="ok">‚úì</span> Vendas Passaporte</div>
      </div>
      <button class="btn-plano btn-premium" onclick="abrirPix('premium')">üíé Assinar Premium</button>
    </div>

  </div>
</div>

<!-- MODAL PIX -->
<div id="modalPix" class="modal">
  <div class="modal-content">
    <div class="modal-title" id="modalPixTitulo">üí≥ Pagamento via Pix</div>
    <div id="alertPix" class="alert"></div>

    <div class="pix-box">
      <div style="color:#94a3b8;font-size:12px;margin-bottom:8px;">Chave Pix</div>
      <!-- ‚úèÔ∏è TROQUE pela sua chave Pix -->
      <div class="pix-chave" id="pixChave">SEU@EMAIL.COM</div>
      <div style="color:#94a3b8;font-size:12px;margin:8px 0 4px;">Valor</div>
      <div class="pix-valor" id="pixValor">R$ 0,00</div>
      <div class="pix-desc" id="pixDesc">Plano B√°sico ‚Äî 1 m√™s</div>
      <button class="copy-btn" onclick="copiarChave()">üìã Copiar Chave Pix</button>
    </div>

    <div class="field">
      <label>Seu nome completo</label>
      <input type="text" id="pixNome" placeholder="Nome do pagador">
    </div>
    <div class="field">
      <label>Comprovante (cole o c√≥digo de transa√ß√£o ou link)</label>
      <textarea id="pixComprovante" rows="3" placeholder="Cole aqui o c√≥digo do comprovante Pix..."></textarea>
    </div>

    <button class="btn-enviar" onclick="enviarPedido()">‚úÖ Enviei o Pix ‚Äî Solicitar Ativa√ß√£o</button>
    <button class="btn-cancelar" onclick="fecharModal()">Cancelar</button>

    <p style="color:#475569;font-size:11px;text-align:center;margin-top:14px;">
      Ap√≥s envio, seu plano ser√° ativado em at√© 24h pelo admin.
    </p>
  </div>
</div>

<script>
  // ‚úèÔ∏è CONFIGURE AQUI OS VALORES E SUA CHAVE PIX
  const CONFIG_PLANOS = {
    basico:  { nome: 'B√°sico',  valor: '9,99', chave: 'clebermiguel42@gmail.com' },
    premium: { nome: 'Premium', valor: '29,99', chave: 'clebermiguel42@gmail.com' }
  };

  let planoSelecionado = null;

  // Atualiza pre√ßos na p√°gina
  document.getElementById('precoBasico').innerHTML  = `R$ ${CONFIG_PLANOS.basico.valor}<span>/m√™s</span>`;
  document.getElementById('precoPremium').innerHTML = `R$ ${CONFIG_PLANOS.premium.valor}<span>/m√™s</span>`;

  async function init() {
    const usuario = await MVAuth.getUsuario();
    if (!usuario) { window.location.href = 'auth.html'; return; }

    const banner = document.getElementById('planoAtualBanner');
    banner.style.display = 'flex';
    document.getElementById('planoAtualNome').textContent = MVAuth.planos[usuario.plano]?.nome || usuario.plano;
    document.getElementById('planoAtualBadge').innerHTML = await MVAuth.getBadgePlano();
  }

  function abrirPix(plano) {
    planoSelecionado = plano;
    const cfg = CONFIG_PLANOS[plano];
    document.getElementById('modalPixTitulo').textContent = `üí≥ Assinar Plano ${cfg.nome}`;
    document.getElementById('pixChave').textContent = cfg.chave;
    document.getElementById('pixValor').textContent = `R$ ${cfg.valor}`;
    document.getElementById('pixDesc').textContent  = `Plano ${cfg.nome} ‚Äî 1 m√™s`;
    document.getElementById('modalPix').classList.add('ativo');
    document.getElementById('alertPix').className = 'alert';
  }

  function fecharModal() {
    document.getElementById('modalPix').classList.remove('ativo');
    planoSelecionado = null;
  }

  function copiarChave() {
    const chave = CONFIG_PLANOS[planoSelecionado]?.chave;
    navigator.clipboard.writeText(chave);
    const btn = document.querySelector('.copy-btn');
    btn.textContent = '‚úÖ Copiado!';
    setTimeout(() => btn.textContent = 'üìã Copiar Chave Pix', 2000);
  }

  async function enviarPedido() {
    const nome = document.getElementById('pixNome').value.trim();
    const comprovante = document.getElementById('pixComprovante').value.trim();
    const alerta = document.getElementById('alertPix');

    if (!nome || !comprovante) {
      alerta.className = 'alert erro';
      alerta.textContent = 'Preencha nome e comprovante.';
      return;
    }

    const sessao = await MVAuth.getSessao();
    if (!sessao) { window.location.href = 'auth.html'; return; }

    const { error } = await _mvClient.from('mv_pedidos').insert([{
      user_id:          sessao.user.id,
      email:            sessao.user.email,
      nome,
      plano_solicitado: planoSelecionado,
      valor:            parseFloat(CONFIG_PLANOS[planoSelecionado].valor.replace(',','.')),
      status:           'pendente',
      pix_chave:        CONFIG_PLANOS[planoSelecionado].chave,
      comprovante_url:  comprovante,
      criado_em:        new Date().toISOString()
    }]);

    if (error) {
      alerta.className = 'alert erro';
      alerta.textContent = 'Erro ao enviar pedido. Tente novamente.';
      return;
    }

    alerta.className = 'alert sucesso';
    alerta.textContent = '‚úÖ Pedido enviado! Seu plano ser√° ativado em at√© 24h.';
    document.getElementById('pixNome').value = '';
    document.getElementById('pixComprovante').value = '';
    setTimeout(fecharModal, 3000);
  }

  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
